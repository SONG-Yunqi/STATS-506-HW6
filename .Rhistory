library(Rcpp)
cppFunction('
double C_moment(NumericVector x, int k) {
int n = x.size();
if (n == 0) return NA_REAL;
double m1 = 0.0;
for (int i = 0; i < n; i++) {
m1 += x[i];
}
m1 /= n;
double m2 = 0.0;
for (int i = 0; i < n; i++) {
m2 += pow(x[i] - m1, k);
}
return m2 / n;
}
')
library(Rcpp)
cppFunction('
double C_moment(NumericVector x, int k) {
int n = x.size();
if (n == 0) return NA_REAL;
double m1 = 0.0;
for (int i = 0; i < n; i++) {
m1 += x[i];
}
m1 /= n;
double m2 = 0.0;
for (int i = 0; i < n; i++) {
m2 += pow(x[i] - m1, k);
}
return m2 / n;
}
')
library(Rcpp)
cppFunction('
double C_moment(NumericVector x, int k) {
int n = x.size();
if (n == 0) return NA_REAL;
double m1 = 0.0;
for (int i = 0; i < n; i++) {
m1 += x[i];
}
m1 /= n;
double m2 = 0.0;
for (int i = 0; i < n; i++) {
m2 += pow(x[i] - m1, k);
}
return m2 / n;
}
')
library(Rcpp)
cppFunction('
double C_moment(NumericVector x, int k) {
int n = x.size();
if (n == 0) return NA_REAL;
double m1 = 0.0;
for (int i = 0; i < n; i++) {
m1 += x[i];
}
m1 /= n;
double m2 = 0.0;
for (int i = 0; i < n; i++) {
m2 += pow(x[i] - m1, k);
}
return m2 / n;
}
')
cppFunction('
double C_moment(NumericVector x, int k) {
int n = x.size();
if (n == 0) return NA_REAL;
double m1 = 0.0;
for (int i = 0; i < n; i++) {
m1 += x[i];
}
m1 /= n;
double m2 = 0.0;
for (int i = 0; i < n; i++) {
m2 += pow(x[i] - m1, k);
}
return m2 / n;
}
')
cppFunction('
double C_moment(NumericVector x, int k) {
int n = x.size();
if (n == 0) return NA_REAL;
double m1 = 0.0;
for (int i = 0; i < n; i++) {
m1 += x[i];
}
m1 /= n;
double m2 = 0.0;
for (int i = 0; i < n; i++) {
m2 += pow(x[i] - m1, k);
}
return m2 / n;
}
')
library(backports)
cppFunction('
double C_moment(NumericVector x, int k) {
int n = x.size();
if (n == 0) return NA_REAL;
double m1 = 0.0;
for (int i = 0; i < n; i++) {
m1 += x[i];
}
m1 /= n;
double m2 = 0.0;
for (int i = 0; i < n; i++) {
m2 += pow(x[i] - m1, k);
}
return m2 / n;
}
')
pkgbuild::has_build_tools(debug = TRUE)
system("g++ --version")
cppFunction('
double C_moment(NumericVector x, int k) {
int n = x.size();
if (n == 0) return NA_REAL;
double m1 = 0.0;
for (int i = 0; i < n; i++) {
m1 += x[i];
}
m1 /= n;
double m2 = 0.0;
for (int i = 0; i < n; i++) {
m2 += pow(x[i] - m1, k);
}
return m2 / n;
}
')
cppFunction('
double C_moment(NumericVector x, int k) {
int n = x.size();
if (n == 0) return NA_REAL;
double m1 = 0.0;
for (int i = 0; i < n; i++) {
m1 += x[i];
}
m1 /= n;
double m2 = 0.0;
for (int i = 0; i < n; i++) {
m2 += pow(x[i] - m1, k);
}
return m2 / n;
}
')
cppFunction('
double C_moment(NumericVector x, int k) {
int n = x.size();
if (n == 0) return NA_REAL;
double m1 = 0.0;
for (int i = 0; i < n; i++) {
m1 += x[i];
}
m1 /= n;
double m2 = 0.0;
for (int i = 0; i < n; i++) {
m2 += pow(x[i] - m1, k);
}
return m2 / n;
}
')
load(file = 'data.RData')
head(df)
table(df['country'])
library(tidyverse)
df_std = df %>%
group_by(country) %>%
mutate(
prior_gpa_z = as.numeric(scale(prior_gpa)),
forum_posts_z = as.numeric(scale(forum_posts)),
quiz_attempts_z = as.numeric(scale(quiz_attempts))
) %>%
ungroup()
library(tidyverse)
df_std = df %>%
group_by(country) %>%
mutate(
prior_gpa_z = as.numeric(scale(prior_gpa)),
forum_posts_z = as.numeric(scale(forum_posts)),
quiz_attempts_z = as.numeric(scale(quiz_attempts))
) %>%
ungroup()
View(df_std)
library(lme4)
install.packages('lme4')
library(lme4)
df_list <- split(df_std, df_std$country)
library(lme4)
df_list <- split(df_std, df_std$country)
library(lme4)
df_list = split(df_std, df_std$country)
View(df_list)
View(df_list)
library(lme4)
df_list = split(df_std, df_std$country)
models = c()
times = c()
for (i in 1:6){
d = df_list[[i]]
t = system.time(
model = glmer(
completed_course ~ prior_gpa_z + forum_posts_z + quiz_attempts_z + (1 | device_type),
data = d,
family = binomial,
control = glmerControl(optimizer = "bobyqa",
optCtrl   = list(maxfun = 2e5))
)
)
models = append(models, model)
times = append(times, t)
}
library(lme4)
df_list = split(df_std, df_std$country)
models = c()
times = c()
for (i in 1:6){
d = df_list[[i]]
t = system.time({
model = glmer(
completed_course ~ prior_gpa_z + forum_posts_z + quiz_attempts_z + (1 | device_type),
data = d,
family = binomial,
control = glmerControl(optimizer = "bobyqa",
optCtrl   = list(maxfun = 2e5))
)}
)
models = append(models, model)
times = append(times, t)
}
times
models[1]
models[2]
times[1]
times[2]
times['sys.self']
library(lme4)
df_list = split(df_std, df_std$country)
models = vector("list", length(df_list))
times  = vector("list", length(df_list))
coef_forum = vector("list", length(df_list))
for (i in seq_along(df_list)){
d = df_list[[i]]
t = system.time({
model = glmer(
completed_course ~ prior_gpa_z + forum_posts_z + quiz_attempts_z + (1 | device_type),
data = d,
family = binomial,
control = glmerControl(optimizer = "bobyqa",
optCtrl   = list(maxfun = 2e5))
)}
)
models[[i]] = model
times[[i]]  = t
cm = summary(model)$coefficients
coef_forum[[i]] = cm["forum_posts_z", ]
}
coef_forum
times
names(times) = names(df_list)
times
coef_df = do.call(rbind, coef_forum)
coef_df$country = names(df_list)
rownames(coef_df) = NULL
ggplot(coef_df, aes(x = reorder(country, Estimate), y = Estimate)) +
geom_point(size = 3, color = "steelblue") +
coord_flip() +
labs(
title = "Estimated Coefficient of Forum Posts by Country",
x = "Country",
y = "Coefficient (log-odds)"
) +
theme_minimal(base_size = 14)
coef_df = do.call(rbind, coef_forum)
coef_df$country = names(df_list)
rownames(coef_df) = NULL
ggplot(coef_df, aes(x = reorder(country, Estimate), y = Estimate)) +
geom_point(size = 3, color = "steelblue") +
coord_flip() +
labs(
title = "Estimated Coefficient of Forum Posts by Country",
x = "Country",
y = "Coefficient (log-odds)"
) +
theme_minimal(base_size = 14)
View(cm)
library(lme4)
df_list = split(df_std, df_std$country)
models = vector("list", length(df_list))
times  = vector("list", length(df_list))
coef_forum = c()
for (i in seq_along(df_list)){
d = df_list[[i]]
t = system.time({
model = glmer(
completed_course ~ prior_gpa_z + forum_posts_z + quiz_attempts_z + (1 | device_type),
data = d,
family = binomial,
control = glmerControl(optimizer = "bobyqa",
optCtrl   = list(maxfun = 2e5))
)}
)
models[[i]] = model
times[[i]]  = t
cm = summary(model)$coefficients
coef_forum = append(coef_forum,cm["forum_posts_z", "Estimate"])
}
names(coef_forum) = names(df_list)
barplot(coef_forum,
main = "Estimated forum_posts by Country",
xlab = "Country",
ylab = "Value",
col = "steelblue")
View(times)
names(times) = names(df_list)
times = do.call(
rbind,
lapply(names(times), function(nm) {
x = times[[nm]]
df_row = as.data.frame(t(x))
df_row$country = nm
df_row
})
)
times
names(times) = names(df_list)
View(times)
View(models)
View(times)
library(lme4)
df_list = split(df_std, df_std$country)
models = vector("list", length(df_list))
times  = vector("list", length(df_list))
coef_forum = c()
for (i in seq_along(df_list)){
d = df_list[[i]]
t = system.time({
model = glmer(
completed_course ~ prior_gpa_z + forum_posts_z + quiz_attempts_z + (1 | device_type),
data = d,
family = binomial,
control = glmerControl(optimizer = "bobyqa",
optCtrl   = list(maxfun = 2e5))
)}
)
models[[i]] = model
times[[i]]  = t
cm = summary(model)$coefficients
coef_forum = append(coef_forum,cm["forum_posts_z", "Estimate"])
}
View(times)
names(coef_forum) = names(df_list)
barplot(coef_forum,
main = "Estimated forum_posts by Country",
xlab = "Country",
ylab = "Value",
col = "steelblue")
names(times) = names(df_list)
times = do.call(
rbind,
lapply(names(times), function(nm) {
x = times[[nm]]
df_row = as.data.frame(t(x))
df_row$country = nm
df_row
})
)
times
library(lme4)
df_list = split(df_std, df_std$country)
models = vector("list", length(df_list))
times  = vector("list", length(df_list))
coef_forum = c()
for (i in seq_along(df_list)){
d = df_list[[i]]
t = system.time({
model = glmer(
completed_course ~ prior_gpa_z + forum_posts_z + quiz_attempts_z + (1 | device_type),
data = d,
family = binomial,
control = glmerControl(optimizer = "bobyqa",
optCtrl   = list(maxfun = 2e5))
)}
)
models[[i]] = model
times[[i]]  = t
cm = summary(model)$coefficients
coef_forum = append(coef_forum,cm["forum_posts_z", "Estimate"])
}
names(coef_forum) = names(df_list)
barplot(coef_forum,
main = "Estimated forum_posts by Country",
xlab = "Country",
ylab = "Value",
col = "steelblue")
names(times) = names(df_list)
times
df_coef = data.frame(country = names(df_list), value = coef_forum)
barplot(coef_forum,
main = "Estimated forum_posts by Country",
xlab = "Country",
ylab = "Value",
col = "steelblue")
View(df_coef)
coef_df = data.frame(country = names(df_list), value = coef_forum)
ggplot(coef_df, aes(x = reorder(country, value), y = value)) +
geom_col(fill = "steelblue") +
geom_text(aes(label = round(value, 3)),
hjust = ifelse(coef_df$value >= 0, -0.2, 1.2),
size = 4) +
coord_flip() +
theme_minimal(base_size = 14)
coef_df = data.frame(country = names(df_list), value = coef_forum)
ggplot(coef_df, aes(x = reorder(country, value), y = value)) +
xlab('Estimated Coefficient') +
ylab('Country')
geom_col(fill = "steelblue") +
geom_text(aes(label = round(value, 3)),
hjust = ifelse(coef_df$value >= 0, -0.2, 1.2),
size = 4) +
coord_flip() +
theme_minimal(base_size = 14)
coef_df = data.frame(country = names(df_list), value = coef_forum)
ggplot(coef_df, aes(x = reorder(country, value), y = value)) +
xlab('Estimated Coefficient') +
ylab('Country')
geom_col(fill = "steelblue") +
geom_text(aes(label = round(value, 3)),
hjust = ifelse(coef_df$value >= 0, -0.2, 1.2),
size = 4) +
coord_flip() +
theme_minimal(base_size = 14)
coef_df = data.frame(country = names(df_list), value = coef_forum)
ggplot(coef_df, aes(x = reorder(country, value), y = value)) +
xlab('Estimated Coefficient') +
ylab('Country') +
geom_col(fill = "steelblue") +
geom_text(aes(label = round(value, 3)),
hjust = ifelse(coef_df$value >= 0, -0.2, 1.2),
size = 4) +
coord_flip() +
theme_minimal(base_size = 14)
library(parallel)
n_cores = min(detectCores() - 1, length(df_list))
cl = makeCluster(n_cores)
clusterExport(cl, varlist = c("df_list"))
clusterEvalQ(cl, { library(lme4); NULL })
total_time = system.time({
results = parLapply(cl, seq_along(df_list), function(i) {
d = df_list[[i]]
model = glmer(
completed_course ~ prior_gpa_z + forum_posts_z + quiz_attempts_z + (1 | device_type),
data = d,
family = binomial,
control = glmerControl(optimizer = "bobyqa",
optCtrl   = list(maxfun = 2e5))
)
return(model)
})
})
stopCluster(cl)
library(parallel)
n_cores = min(detectCores() - 1, length(df_list))
cl = makeCluster(n_cores)
clusterExport(cl, varlist = c("df_list"))
clusterEvalQ(cl, { library(lme4) })
total_time = system.time({
results = parLapply(cl, seq_along(df_list), function(i) {
d = df_list[[i]]
model = glmer(
completed_course ~ prior_gpa_z + forum_posts_z + quiz_attempts_z + (1 | device_type),
data = d,
family = binomial,
control = glmerControl(optimizer = "bobyqa",
optCtrl   = list(maxfun = 2e5))
)
return(model)
})
})
stopCluster(cl)
total_time
coef_forum1 = c()
for (i in 1:length(df_list)){
model = results[[i]]
cm = summary(model)$coefficients
coef_forum1 = append(coef_forum1,cm["forum_posts_z", "Estimate"])
}
coef_df1 = data.frame(country = names(df_list), value = coef_forum1)
ggplot(coef_df1, aes(x = reorder(country, value), y = value)) +
xlab('Estimated Coefficient') +
ylab('Country') +
geom_col(fill = "steelblue") +
geom_text(aes(label = round(value, 3)),
hjust = ifelse(coef_df$value >= 0, -0.2, 1.2),
size = 4) +
coord_flip() +
theme_minimal(base_size = 14)
source('waldCI')
source('waldCI.R')
source('waldCI.R')
source('waldCI.R')
